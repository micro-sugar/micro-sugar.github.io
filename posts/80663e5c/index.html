<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-tw"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Machine learning,Microsoft Azure,Auto train models,"><meta name="description" content="最近在看機械學習(machine learning)時，我遇到一個困難就是演算法太多種常常要花很多時間才能選擇到適合的演算法，而且每種演算法光理解及學習就會花很多時間；所以，要如何迅速地找到一個適合的演算法就是我遇到的一個大問題了。 經過我搜尋後，找到一個解決方法，就是Microsoft Azure的Auto train models；這個工具可以自己找到適合的演算法、自動化的調整參數及產出模型。"><meta name="keywords" content="Machine learning,Microsoft Azure,Auto train models"><meta property="og:type" content="article"><meta property="og:title" content="微軟的自動化機械學習服務"><meta property="og:url" content="https://blog.microsugar.tw/posts/80663e5c/index.html"><meta property="og:site_name" content="微糖少冰"><meta property="og:description" content="最近在看機械學習(machine learning)時，我遇到一個困難就是演算法太多種常常要花很多時間才能選擇到適合的演算法，而且每種演算法光理解及學習就會花很多時間；所以，要如何迅速地找到一個適合的演算法就是我遇到的一個大問題了。 經過我搜尋後，找到一個解決方法，就是Microsoft Azure的Auto train models；這個工具可以自己找到適合的演算法、自動化的調整參數及產出模型。"><meta property="og:locale" content="zh-tw"><meta property="og:image" content="https://4.bp.blogspot.com/-D8zSWVkg4Lo/W_TZNgI4GwI/AAAAAAAABO8/9Oz2lmo1yG8poIB4qoMhDGt9CjPfdbi5wCKgBGAs/s1600/createMachineLearningServiceWorkspace1.jpg"><meta property="og:image" content="https://2.bp.blogspot.com/-eNfp6InTQqk/W_TZNmCFLtI/AAAAAAAABO8/U1VG7YSXqD44u6o11aZYpQt9NuCyiNBMgCKgBGAs/s1600/createMachineLearningServiceWorkspace2.jpg"><meta property="og:image" content="https://2.bp.blogspot.com/-qC4pqsuX6L0/W_TZNrcFQlI/AAAAAAAABO8/ZjS9eJ3kEQ8rRlrqOPxNnBC9c3yVkhAAwCKgBGAs/s1600/getSubscriptionId.jpg"><meta property="og:image" content="https://1.bp.blogspot.com/-PYBedBuhNw4/W_TZNouMocI/AAAAAAAABO8/ALdkLypz1S0uG_yMnx7TPSb64K8cDTc7gCKgBGAs/s1600/testDataIndex.png"><meta property="og:image" content="https://2.bp.blogspot.com/-wBCUYsLwdbk/W_TZNjeTI3I/AAAAAAAABO8/acwNYzx_Ml8k4YT4Ec5A7Vh4VVbgsK7bwCKgBGAs/s1600/Azure_MLWS_Model.jpg"><meta property="og:image" content="https://1.bp.blogspot.com/-1oFSzeQzkig/W_TZNkkynFI/AAAAAAAABO8/7OalVQ7lWNUWvE_f9tILUDIZtpt5kzyJgCKgBGAs/s1600/finishTestDataIndex.png"><meta property="og:updated_time" content="2018-11-21T04:19:03.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="微軟的自動化機械學習服務"><meta name="twitter:description" content="最近在看機械學習(machine learning)時，我遇到一個困難就是演算法太多種常常要花很多時間才能選擇到適合的演算法，而且每種演算法光理解及學習就會花很多時間；所以，要如何迅速地找到一個適合的演算法就是我遇到的一個大問題了。 經過我搜尋後，找到一個解決方法，就是Microsoft Azure的Auto train models；這個工具可以自己找到適合的演算法、自動化的調整參數及產出模型。"><meta name="twitter:image" content="https://4.bp.blogspot.com/-D8zSWVkg4Lo/W_TZNgI4GwI/AAAAAAAABO8/9Oz2lmo1yG8poIB4qoMhDGt9CjPfdbi5wCKgBGAs/s1600/createMachineLearningServiceWorkspace1.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://blog.microsugar.tw/posts/80663e5c/"><title>微軟的自動化機械學習服務 | 微糖少冰</title><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-125973302-1","auto"),ga("send","pageview")</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-tw"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">微糖少冰</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description"></h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首頁</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 標籤</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分類</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 歸檔</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.microsugar.tw/posts/80663e5c/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Chase chu"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="微糖少冰"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">微軟的自動化機械學習服務</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">發表於</span> <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-11-15T09:08:03+00:00">2018-11-15</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分類於</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Machine-learning/" itemprop="url" rel="index"><span itemprop="name">Machine learning</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span><a href="/posts/80663e5c/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/80663e5c/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>最近在看機械學習(machine learning)時，我遇到一個困難就是演算法太多種常常要花很多時間才能選擇到適合的演算法，而且每種演算法光理解及學習就會花很多時間；所以，要如何迅速地找到一個適合的演算法就是我遇到的一個大問題了。</p><p>經過我搜尋後，找到一個解決方法，就是Microsoft Azure的Auto train models；這個工具可以自己找到適合的演算法、自動化的調整參數及產出模型。</p><p>本篇是依微軟文件理解後重新整理出來的，如果要看原文，可以直接拉到最下面由連結至原文資料。</p><h2 id="環境需求"><a href="#環境需求" class="headerlink" title="環境需求"></a>環境需求</h2><ul><li>有Azure帳號</li><li>Anaconda(只有Python也可以，不過部分指令會不太一樣)</li></ul><h3 id="建立練習的Python虛擬環境"><a href="#建立練習的Python虛擬環境" class="headerlink" title="建立練習的Python虛擬環境"></a>建立練習的Python虛擬環境</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 創建 Python 3.6 名為myenv的新conda環境。</span></span><br><span class="line">conda create -n envAutoML -y Python=3.6</span><br><span class="line"><span class="comment"># 啟動環境</span></span><br><span class="line">conda activate envAutoML</span><br><span class="line"><span class="comment"># 更新pip</span></span><br><span class="line">python -m pip install --upgrade pip</span><br><span class="line"><span class="comment"># 安裝其他會用到的套件</span></span><br><span class="line">pip install pandas</span><br><span class="line">pip install matplotlib</span><br><span class="line">pip install psutil</span><br></pre></td></tr></table></figure><h3 id="安裝Azure-Machine-Learning-SDK-for-Python"><a href="#安裝Azure-Machine-Learning-SDK-for-Python" class="headerlink" title="安裝Azure Machine Learning SDK for Python"></a>安裝Azure Machine Learning SDK for Python</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在環境中安裝安裝AzureMachine Learning SDK的核心組件(包含Jupyter Notebook)</span></span><br><span class="line">pip install --upgrade azureml-sdk[notebooks,automl]</span><br></pre></td></tr></table></figure><h3 id="Azure前置作業"><a href="#Azure前置作業" class="headerlink" title="Azure前置作業"></a>Azure前置作業</h3><p>這邊要記錄下三組字串等等給SDK用</p><ul><li>resource_group: 資源群組</li><li>workspace_name: Azure中Machine Learning service workspace的名稱</li><li>subscription_id: Azure訂用帳戶 ID</li></ul><h4 id="Azure上建立Machine-Learning-service-workspace"><a href="#Azure上建立Machine-Learning-service-workspace" class="headerlink" title="Azure上建立Machine Learning service workspace"></a>Azure上建立Machine Learning service workspace</h4><p>進入Azure後<br>首先先選建立資源，並找到並選擇Machine Learning service workspace<br><br><img src="https://4.bp.blogspot.com/-D8zSWVkg4Lo/W_TZNgI4GwI/AAAAAAAABO8/9Oz2lmo1yG8poIB4qoMhDGt9CjPfdbi5wCKgBGAs/s1600/createMachineLearningServiceWorkspace1.jpg" alt="Azure Machine Learning service workspace建立步驟一"><br>填入工作區名稱(workspace_name)<br>資源存組(resource_group)<br>及選擇位置(選擇最近的就可以了)<br><br><img src="https://2.bp.blogspot.com/-eNfp6InTQqk/W_TZNmCFLtI/AAAAAAAABO8/U1VG7YSXqD44u6o11aZYpQt9NuCyiNBMgCKgBGAs/s1600/createMachineLearningServiceWorkspace2.jpg" alt="Azure Machine Learning service workspace建立步驟二"></p><h4 id="紀錄Azure訂用帳戶ID"><a href="#紀錄Azure訂用帳戶ID" class="headerlink" title="紀錄Azure訂用帳戶ID"></a>紀錄Azure訂用帳戶ID</h4><p>於左側選單點選訂用帳戶後再將右邊的訂用帳戶ID(subscription_id)記錄下來<br><br><img src="https://2.bp.blogspot.com/-qC4pqsuX6L0/W_TZNrcFQlI/AAAAAAAABO8/ZjS9eJ3kEQ8rRlrqOPxNnBC9c3yVkhAAwCKgBGAs/s1600/getSubscriptionId.jpg" alt="取得Azure訂閱帳戶ID"></p><h3 id="建立Workspace及其配置文件（config-json）"><a href="#建立Workspace及其配置文件（config-json）" class="headerlink" title="建立Workspace及其配置文件（config.json）"></a>建立Workspace及其配置文件（config.json）</h3><p>如果未移除Azure資源(下面會說到)，此部分只需要做一次<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> azureml.core <span class="keyword">import</span> Workspace</span><br><span class="line"></span><br><span class="line">subscription_id =<span class="string">'dxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxx290'</span> <span class="comment"># 將上面記錄的"subscription_id"填入</span></span><br><span class="line">resource_group =<span class="string">'MLGroup'</span> <span class="comment"># 將上面記錄的"resource_group"填入</span></span><br><span class="line">workspace_name = <span class="string">'AutoTrainModels-ws'</span> <span class="comment"># 將上面記錄的"workspace_name"填入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   <span class="comment"># 建立Workspace</span></span><br><span class="line">   ws = Workspace(subscription_id = subscription_id, resource_group = resource_group, workspace_name = workspace_name)</span><br><span class="line">   <span class="comment"># 將Workspace寫入成配置文件</span></span><br><span class="line">   ws.write_config()</span><br><span class="line">   print(<span class="string">'Library configuration succeeded'</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">   print(<span class="string">'Workspace not found'</span>)</span><br></pre></td></tr></table></figure><p></p><h2 id="使用Auto-train-models"><a href="#使用Auto-train-models" class="headerlink" title="使用Auto train models"></a>使用Auto train models</h2><h3 id="Import-packages"><a href="#Import-packages" class="headerlink" title="Import packages"></a>Import packages</h3><p>python載入會用到的套件<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> azureml.core</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> azureml.core.workspace <span class="keyword">import</span> Workspace</span><br><span class="line"><span class="keyword">from</span> azureml.train.automl.run <span class="keyword">import</span> AutoMLRun</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.pyplot <span class="keyword">import</span> imshow</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><p></p><h3 id="Load-workspace"><a href="#Load-workspace" class="headerlink" title="Load workspace"></a>Load workspace</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 讀取設定檔</span></span><br><span class="line">ws = Workspace.from_config()</span><br><span class="line"><span class="comment"># 指定實驗的名稱</span></span><br><span class="line">experiment_name = <span class="string">'automl-classifier'</span></span><br><span class="line"><span class="comment"># 創建並註冊本地目錄。 所有運行實驗的歷史記錄下記錄會存在這。</span></span><br><span class="line">project_folder = <span class="string">'./automl-classifier'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目前Workspace相關的參數(用jupyter會顯示出來)</span></span><br><span class="line">output = &#123;&#125;</span><br><span class="line">output[<span class="string">'SDK version'</span>] = azureml.core.VERSION</span><br><span class="line">output[<span class="string">'Subscription ID'</span>] = ws.subscription_id</span><br><span class="line">output[<span class="string">'Workspace'</span>] = ws.name</span><br><span class="line">output[<span class="string">'Resource Group'</span>] = ws.resource_group</span><br><span class="line">output[<span class="string">'Location'</span>] = ws.location</span><br><span class="line">output[<span class="string">'Project Directory'</span>] = project_folder</span><br><span class="line">pd.set_option(<span class="string">'display.max_colwidth'</span>, <span class="number">-1</span>)</span><br><span class="line">pd.DataFrame(data=output, index=[<span class="string">''</span>]).T</span><br></pre></td></tr></table></figure><h3 id="瀏覽資料"><a href="#瀏覽資料" class="headerlink" title="瀏覽資料"></a>瀏覽資料</h3><p>這邊使用的測試資料是<a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_digits.html" target="_blank" rel="noopener">scikit-learn</a>的範例資料集-Optical Recognition of Handwritten Digits Data Set(手寫數字數據集的光學識別)<br><br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="comment"># 載入Optical Recognition of Handwritten Digits Data Set</span></span><br><span class="line">digits = datasets.load_digits()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 從訓練中排除前100行，以便它們可用於測試。</span></span><br><span class="line">X_train = digits.data[<span class="number">100</span>:,:]</span><br><span class="line">y_train = digits.target[<span class="number">100</span>:]</span><br></pre></td></tr></table></figure><p></p><p>這邊可以看看這次進行Machine Learning的測試資料<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 將數據加載到`numpy`數組中。 然後使用`matplotlib`繪製來自數據集的30個隨機圖像及其上方的標籤。</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">sample_size = <span class="number">30</span></span><br><span class="line">plt.figure(figsize = (<span class="number">16</span>, <span class="number">6</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.random.permutation(X_train.shape[<span class="number">0</span>])[:sample_size]:</span><br><span class="line">    count = count + <span class="number">1</span></span><br><span class="line">    plt.subplot(<span class="number">1</span>, sample_size, count)</span><br><span class="line">    plt.axhline(<span class="string">''</span>)</span><br><span class="line">    plt.axvline(<span class="string">''</span>)</span><br><span class="line">    plt.text(x = <span class="number">2</span>, y = <span class="number">-2</span>, s = y_train[i], fontsize = <span class="number">18</span>)</span><br><span class="line">    plt.imshow(X_train[i].reshape(<span class="number">8</span>, <span class="number">8</span>), cmap = plt.cm.Greys)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p></p><p><img src="https://1.bp.blogspot.com/-PYBedBuhNw4/W_TZNouMocI/AAAAAAAABO8/ALdkLypz1S0uG_yMnx7TPSb64K8cDTc7gCKgBGAs/s1600/testDataIndex.png" alt="待學習資料"></p><h3 id="自動訓練模型-Auto-train-a-model"><a href="#自動訓練模型-Auto-train-a-model" class="headerlink" title="自動訓練模型(Auto train a model)"></a>自動訓練模型(Auto train a model)</h3><p>第一步要設定AutoMLConfig<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> azureml.train.automl <span class="keyword">import</span> AutoMLConfig</span><br><span class="line"></span><br><span class="line"><span class="comment">##Local compute </span></span><br><span class="line">Automl_config = AutoMLConfig(</span><br><span class="line">   task = <span class="string">'classification'</span>, <span class="comment"># 機器學習問題的類型。 允許的值包括classification,regression</span></span><br><span class="line">   primary_metric = <span class="string">'AUC_weighted'</span>, <span class="comment"># </span></span><br><span class="line">   max_time_sec = <span class="number">12000</span>, <span class="comment"># 限制疊代運算所花費的時間量 (秒)</span></span><br><span class="line">   iterations = <span class="number">20</span>, <span class="comment"># 疊代運算次數上限。 每次疊代運算相當於一個產生管線的訓練作業。 管線是資料前置處理和模型。 若要取得高品質的模型，請使用 250 或更高的值</span></span><br><span class="line">   n_cross_validations = <span class="number">3</span>, <span class="comment"># 交叉驗證分割數目</span></span><br><span class="line">   exit_score = <span class="number">0.9985</span>, <span class="comment"># primary_metric 的目標值，達到目標後會停止反覆運算</span></span><br><span class="line">   blacklist_algos = [], <span class="comment"># 自動化 ML 以從實驗中排除特定演算法</span></span><br><span class="line">   X = X_train, <span class="comment"># 所有要用於訓練的特徵</span></span><br><span class="line">   y = y_train, <span class="comment"># 要用於訓練的資料標籤。應為整數的陣列。</span></span><br><span class="line">   path=project_folder)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以本地運行。 將計算目標定義為local，並將輸出設置為true以查看實驗的進度。</span></span><br><span class="line"><span class="keyword">from</span> azureml.core.experiment <span class="keyword">import</span> Experiment</span><br><span class="line">experiment=Experiment(ws, experiment_name)</span><br><span class="line">local_run = experiment.submit(Automl_config, show_output=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到具有最高準確度值的運行</span></span><br><span class="line">best_run, fitted_model = local_run.get_output()</span><br></pre></td></tr></table></figure><p></p><p> 如果上面的設定項裡面有不懂的，這邊附上可以參考學習的資料</p><ul><li>task: <a href="https://blogs.msdn.microsoft.com/mengtsai/2015/01/08/azure-algorithms/" target="_blank" rel="noopener">Azure 「機器學習」：我該用哪種演算法 (algorithms)?</a></li><li>primary_metric: <a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/evaluate-model" target="_blank" rel="noopener">評估模型(Evaluate Model)</a></li><li>iterations: <a href="https://zh.wikipedia.org/wiki/%E8%BF%AD%E4%BB%A3" target="_blank" rel="noopener">疊代</a></li><li>n_cross_validations: <a href="https://zh.wikipedia.org/wiki/%E4%BA%A4%E5%8F%89%E9%A9%97%E8%AD%89" target="_blank" rel="noopener">交叉驗證</a></li></ul><h3 id="註冊最佳模型"><a href="#註冊最佳模型" class="headerlink" title="註冊最佳模型"></a>註冊最佳模型</h3><p>將最好的模型註冊至Machine Learning Workspace下的Model<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取得最好的模型</span></span><br><span class="line">best_run, fitted_model = local_run.get_output()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 將模型註冊至workspace</span></span><br><span class="line">description = <span class="string">'Automated Machine Learning Model'</span></span><br><span class="line">tags = <span class="keyword">None</span></span><br><span class="line">local_run.register_model(description=description, tags=tags)</span><br><span class="line">local_run.model_id <span class="comment"># 這邊會產出一個ID，可以在Machine Learning workspace 的Model那邊看到相同ID的Model</span></span><br></pre></td></tr></table></figure><p></p><p><img src="https://2.bp.blogspot.com/-wBCUYsLwdbk/W_TZNjeTI3I/AAAAAAAABO8/acwNYzx_Ml8k4YT4Ec5A7Vh4VVbgsK7bwCKgBGAs/s1600/Azure_MLWS_Model.jpg" alt="Azure上Model"></p><h3 id="測試最佳模型"><a href="#測試最佳模型" class="headerlink" title="測試最佳模型"></a>測試最佳模型</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 從測試集中找到30個隨機樣本</span></span><br><span class="line">n = <span class="number">30</span></span><br><span class="line">X_test = digits.data[:<span class="number">100</span>, :]</span><br><span class="line">y_test = digits.target[:<span class="number">100</span>]</span><br><span class="line">sample_indices = np.random.permutation(X_test.shape[<span class="number">0</span>])[<span class="number">0</span>:n]</span><br><span class="line">test_samples = X_test[sample_indices]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用上面找到的最佳模型進行測試</span></span><br><span class="line">result = fitted_model.predict(test_samples)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比較實際值與預測值：</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">plt.figure(figsize = (<span class="number">20</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> sample_indices:</span><br><span class="line">    plt.subplot(<span class="number">1</span>, n, i + <span class="number">1</span>)</span><br><span class="line">    plt.axhline(<span class="string">''</span>)</span><br><span class="line">    plt.axvline(<span class="string">''</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 對錯誤分類的樣本使用不同的顏色</span></span><br><span class="line">    font_color = <span class="string">'red'</span> <span class="keyword">if</span> y_test[s] != result[i] <span class="keyword">else</span> <span class="string">'black'</span></span><br><span class="line">    clr_map = plt.cm.gray <span class="keyword">if</span> y_test[s] != result[i] <span class="keyword">else</span> plt.cm.Greys</span><br><span class="line">    </span><br><span class="line">    plt.text(x = <span class="number">2</span>, y = <span class="number">-2</span>, s = result[i], fontsize = <span class="number">18</span>, color = font_color)</span><br><span class="line">    plt.imshow(X_test[s].reshape(<span class="number">8</span>, <span class="number">8</span>), cmap = clr_map)</span><br><span class="line">    </span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://1.bp.blogspot.com/-1oFSzeQzkig/W_TZNkkynFI/AAAAAAAABO8/7OalVQ7lWNUWvE_f9tILUDIZtpt5kzyJgCKgBGAs/s1600/finishTestDataIndex.png" alt="驗證的結果"><br>其中上面標紅色字的就是機器人判斷錯誤的</p><h3 id="移除Azure資源"><a href="#移除Azure資源" class="headerlink" title="移除Azure資源"></a>移除Azure資源</h3><p>如果不打算繼續使用了，請將其刪除，以免產生費用。<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws.delete(delete_dependent_resources=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><p></p><h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><ul><li>優點: 快速、方便，在專案內沒有專業的數據科學家時可以快速的建立Machine learning的Model</li><li>缺點: 需要使用付費的Microsoft的Azure服務、目前只支援監督式學習(Supervised learning)</li></ul><h2 id="備註"><a href="#備註" class="headerlink" title="備註"></a>備註</h2><h3 id="相關資料"><a href="#相關資料" class="headerlink" title="相關資料"></a>相關資料</h3><ul><li><a href="https://docs.microsoft.com/zh-tw/azure/machine-learning/service/how-to-automated-ml" target="_blank" rel="noopener">什麼是自動化機器學習服務？</a></li><li><a href="https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/machine-learning/service/how-to-configure-auto-train.md" target="_blank" rel="noopener">how-to-configure-auto-train</a></li><li><a href="https://docs.microsoft.com/zh-tw/python/api/overview/azure/ml/intro?view=azure-ml-py" target="_blank" rel="noopener">Azure Machine Learning SDK for Python</a></li><li><a href="https://blogs.msdn.microsoft.com/mengtsai/2015/01/08/azure-algorithms/" target="_blank" rel="noopener">Azure 「機器學習」：我該用哪種演算法 (algorithms)?</a></li><li><a href="https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/evaluate-model" target="_blank" rel="noopener">評估模型(Evaluate Model)</a></li><li><a href="https://www.gss.com.tw/index.php/focus/eis/157-eis82/1540-eis82-2" target="_blank" rel="noopener">如何確保大數據分析的品質：淺談監督式機器學習的測試評估方法</a></li><li><a href="https://medium.com/@chih.sheng.huang821/%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92-%E7%B5%B1%E8%A8%88%E6%96%B9%E6%B3%95-%E6%A8%A1%E5%9E%8B%E8%A9%95%E4%BC%B0-%E9%A9%97%E8%AD%89%E6%8C%87%E6%A8%99-b03825ff0814" target="_blank" rel="noopener">機器學習\統計方法: 模型評估-驗證指標(validation index)</a></li><li><a href="https://zh.wikipedia.org/wiki/%E8%BF%AD%E4%BB%A3" target="_blank" rel="noopener">wiki-疊代</a></li><li><a href="https://zh.wikipedia.org/wiki/%E4%BA%A4%E5%8F%89%E9%A9%97%E8%AD%89" target="_blank" rel="noopener">wiki-交叉驗證</a></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Machine-learning/" rel="tag"># Machine learning</a> <a href="/tags/Microsoft-Azure/" rel="tag"># Microsoft Azure</a> <a href="/tags/Auto-train-models/" rel="tag"># Auto train models</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/c01d2700/" rel="next" title="Windows下使用ssh連結Bitbucket(Git)"><i class="fa fa-chevron-left"></i> Windows下使用ssh連結Bitbucket(Git)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/5ba411a/" rel="prev" title="Vuepress加入Bootstrap">Vuepress加入Bootstrap<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目錄</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 本站概覽</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Chase chu</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">文章</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分類</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">標籤</span></a></div></nav></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#環境需求"><span class="nav-number">1.</span> <span class="nav-text">環境需求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#建立練習的Python虛擬環境"><span class="nav-number">1.1.</span> <span class="nav-text">建立練習的Python虛擬環境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安裝Azure-Machine-Learning-SDK-for-Python"><span class="nav-number">1.2.</span> <span class="nav-text">安裝Azure Machine Learning SDK for Python</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Azure前置作業"><span class="nav-number">1.3.</span> <span class="nav-text">Azure前置作業</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Azure上建立Machine-Learning-service-workspace"><span class="nav-number">1.3.1.</span> <span class="nav-text">Azure上建立Machine Learning service workspace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#紀錄Azure訂用帳戶ID"><span class="nav-number">1.3.2.</span> <span class="nav-text">紀錄Azure訂用帳戶ID</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#建立Workspace及其配置文件（config-json）"><span class="nav-number">1.4.</span> <span class="nav-text">建立Workspace及其配置文件（config.json）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Auto-train-models"><span class="nav-number">2.</span> <span class="nav-text">使用Auto train models</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Import-packages"><span class="nav-number">2.1.</span> <span class="nav-text">Import packages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Load-workspace"><span class="nav-number">2.2.</span> <span class="nav-text">Load workspace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#瀏覽資料"><span class="nav-number">2.3.</span> <span class="nav-text">瀏覽資料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自動訓練模型-Auto-train-a-model"><span class="nav-number">2.4.</span> <span class="nav-text">自動訓練模型(Auto train a model)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#註冊最佳模型"><span class="nav-number">2.5.</span> <span class="nav-text">註冊最佳模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#測試最佳模型"><span class="nav-number">2.6.</span> <span class="nav-text">測試最佳模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除Azure資源"><span class="nav-number">2.7.</span> <span class="nav-text">移除Azure資源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#結論"><span class="nav-number">3.</span> <span class="nav-text">結論</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#備註"><span class="nav-number">4.</span> <span class="nav-text">備註</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#相關資料"><span class="nav-number">4.1.</span> <span class="nav-text">相關資料</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Chase chu</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動</div> <span class="post-meta-divider">|</span><div class="theme-info">主題 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery_lazyload/1.9.7/jquery.lazyload.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script id="dsq-count-scr" src="https://blog-microsugar-tw.disqus.com/count.js" async></script><script type="text/javascript">var disqus_config=function(){this.page.url="https://blog.microsugar.tw/posts/80663e5c/",this.page.identifier="posts/80663e5c/",this.page.title="微軟的自動化機械學習服務"},d=document,s=d.createElement("script");s.src="https://blog-microsugar-tw.disqus.com/embed.js",s.setAttribute("data-timestamp",""+ +new Date),(d.head||d.body).appendChild(s)</script></body></html>